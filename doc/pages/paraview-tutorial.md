# ParaView Tutorial {#paraview-tutorial}

@tableofcontents

In this section, we provide a basic introduction to @paraview.
This tutorial is designed to give you a quick start
on creating plots of the results generated by @sapphire.
We will use the output generated by the [quick-start](#quick-start) example for illustration.

This tutorial is not intended to be a comprehensive introduction to @paraview.
For a more detailed guide, please refer to the
[ParaView User Guide](https://docs.paraview.org/en/latest/).
We want to clarify that all tasks presented here can also be accomplished using
[VisIt](https://visit-dav.github.io/visit-website/).
The author does not express any preference
for @paraview over [VisIt](https://visit-dav.github.io/visit-website/).
The example images in this tutorial use
[ParaView Version 5.12.1](https://www.paraview.org/download/) on macOS.
Please note that the interface may be subject to alterations.

## Install ParaView {#paraview-installation}

To install @paraview,
you can download the latest version on the
[ParaView download page](https://www.paraview.org/download/).
On most Linux systems
you can alternatively use the package manager, e.g.,

```bash
sudo apt-get install paraview
```

On macOS,
you can use [Homebrew](https://brew.sh/) to install @paraview:

```bash
brew install --cask paraview
```

As an alternative,
@paraview can be installed using
[conda](https://docs.conda.io/)/[conda-forge](https://conda-forge.org/).

```bash
conda create --name ParaView python=3.13
conda activate ParaView
conda install paraview
```

## Open Files {#paraview-open}

After launching @paraview,
follow these steps to open the results
generated by the [quick-start](#quick-start) example:

1. **Open File Dialog:**
   Click **Open** to open the file selection dialog.

   ![Open File Dialog](https://sapphirepp.org/img/paraview-tutorial/open-01-annotated.png)

2. **Navigate to Results Folder:**
   Browse to the results folder located at
   `/path/to/sapphirepp/results/01`.

3. **Select Files:**
   Select the `solution_*.pvtu` files as a *Group*
   to open the results as a *time-series*.

4. **Confirm Selection:**
   Click **OK** to confirm
   and load the selected files.

   ![Select Files](https://sapphirepp.org/img/paraview-tutorial/open-02-annotated.png)

## Visualize the Data as a 2D Plot {#paraview-data}

To get an initial impression of the data,
we will visualize it in a 2D plot.
As discussed in the [quick-start](#quick-start),
the x-axis in this plot corresponds to the spatial variable $x$,
while the y-axis represents the momentum component $\ln p$.

1. **Display the Data:**
   Click **Apply** to display the data. Initially, this
   will show the 2D data plane without any coloring.

2. **Plot** $f_{000}(x, \ln p)$:
   To create a false color plot of the isotropic component $f_{000}(x, \ln p)$,
   select `f_000` as the quantity to display.

3. **Animate Time Evolution:**
   Click **Play** to animate through the different time steps.

   ![Show the Data](https://sapphirepp.org/img/paraview-tutorial/data-01-annotated.png)

4. **Adjust Visible Data Range:**
   If the displayed results look incorrect,
   it may be because the visible data range does not match the actual data range.
   To fix this, click **Rescale to Data Range**.

5. **Update Color Map:**
   The color map will adjust accordingly,
   now showing meaningful values that represent the results.

   ![Adjust Visible Data Range](https://sapphirepp.org/img/paraview-tutorial/data-02-annotated.png)

## Create f(x) Plot {#paraview-f_x}

To visualize a cut-out of the data along the x-axis,
follow these steps:

1. **Plot Over Line:**
   Click on **Plot Over Line** to create a line
   along which @paraview will generate a cut-out of the data.

2. **Align Line with X-Axis:**
   Align the line along the x-axis by clicking **X-Axis**.

3. **Shift the Line:**
   To avoid sampling values exactly along a cell boundary,
   we recommend shifting the line slightly in the y-direction.
   Adjust the y-values of the start and end points,
   **Point1** and **Point2**,
   to achieve this.
   For more details on this practice,
   refer to the
   [Tips and Tricks for Visualization](#paraview-visualization)
    section.

4. **Apply Changes:**
   Click **Apply** to apply the changes.

   ![Plot Over Line](https://sapphirepp.org/img/paraview-tutorial/f_x-01-annotated.png)

5. **Line Chart View:**
   A new window with a *LineChartView* is created,
   showing the data along the defined line.

6. **X-Axis Values:**
   You might notice that the values on the x-axis do not represent the x-coordinate.
   Instead, they show the *arc_length*, the length along the line.

7. **Adjust X-Axis:**
   To adjust the values along the x-axis,
   change the **X Array Name** to **Points_X**.

8. **Reset View:**
   The line chart plot might now show the wrong data range
   for the x-coordinates.
   To adjust the view, click **Reset**.

   ![Adjust X-Axis](https://sapphirepp.org/img/paraview-tutorial/f_x-02-annotated.png)

The line plot now shows all coefficients $f_{lms}(x)$
(plus the additional quantity `subdomain`).
Since only $f_{000}$ and $f_{100}$ are non-zero,
we want to remove the other quantities from the plot to improve readability.
Follow these steps:

1. **Select Data Object:**
   In the **Pipeline Browser**,
   select `solution_0000.pvtu*` to modify the quantities related to the data object.

2. **Select Arrays:**
   In the **Properties** window,
   select only `f_000` and `f_100` to be displayed.
   Deactivate all other quantities.

3. **Apply Changes:**
   Click **Apply** to apply the changes.

4. **Legend:**
   The legend will now only show the `f_000` and `f_100` components.

   ![Select Arrays](https://sapphirepp.org/img/paraview-tutorial/f_x-03-annotated.png)

## Create f(p) Plot {#paraview-f_p}

Next, we want to create a plot of $p^4 f_{000}(p)$.
Scaling by $p^4$ helps in visualizing
the $f_{000}(p) \propto p^{-4}$ power law more effectively.
To generate this plot,
we first need to calculate the quantity $p^4 f_{000}$:

1. **Select Render View:**
   Click on **RenderView1** to ensure it is selected before proceeding.

2. **Select Data Object:**
   In the **Pipeline Browser**,
   select `solution_0000.pvtu*` to start from the original data
   for calculating the derived quantity $p^4 f_{000}$.

3. **Create Calculator:**
   Click on
   **Filters** > **Common** > **Calculator**
   to create a new calculator object.

   ![Create Calculator](https://sapphirepp.org/img/paraview-tutorial/f_p-01-annotated.png)

4. **Enter Equation:**
   In the equation field, enter the following expression:
   `exp(4*CoordsY) * f_000`.
   Here, `CoordsY` represents the y-coordinate,
   i.e., $\ln p$.
   You can see a list of available quantities in the calculator
   by clicking on **Scalars**.

5. **Enter Array Name:**
   In the **Result Array Name** field,
   enter a name for the result.
   LaTeX is supported,
   so we use `$p^4 f_{000}$`.

6. **Apply the Change:**
   Click on **Apply** to apply the changes.
   The 2D plot will now show a second color bar
   displaying $p^4 f_{000}$.

   ![Calculate p^4 f_000](https://sapphirepp.org/img/paraview-tutorial/f_p-02-annotated.png)

To create a line plot along the $\ln p$-axis,
we can follow a similar procedure as before:

1. **Plot Over Line:**
   Click on **Plot Over Line** to create a new line
   for a cut-out of the data.

2. **Align Line with Y-Axis:**
   Align the line along the y-axis/$\ln p$-axis
   by clicking **Y-Axis**.

3. **Shift the Line:**
   To avoid sampling values exactly along a cell boundary,
   shift the line slightly in the x-direction
   by adjusting the x-values of the start and end points,
    **Point1** and **Point2**.

4. **Apply Changes:**
   Click **Apply** to apply the changes.

   ![Plot Over Line](https://sapphirepp.org/img/paraview-tutorial/f_p-03-annotated.png)

5. **Line Chart View:**
   A new window with a *LineChartView* is created,
   showing the data along the defined line.

6. **Adjust X-Axis:**
   Change the **X Array Name** to **Points_Y**
   to adjust the values along the x-axis,
   corresponding to $\ln p$.

7. **Filter Quantities:**
   To display only the $p^4 f_{000}$ quantity,
   deactivate `f_000` and `f_100` in the **Series Parameters** selection.

8. **Reset View:**
   Click **Reset** to adjust the view.

   ![Adjust Axis](https://sapphirepp.org/img/paraview-tutorial/f_p-04-annotated.png)

For better visualization, we want to use a log-log plot.
The x-axis, $\ln p$, is already a logarithmic variable,
but we can use built-in @paraview features to scale the y-axis logarithmically.
Follow these steps:

1. **Set Custom Range for Y-Axis:**
   Click on **Left Axis Custom Range**
   to enable custom range settings for the y-axis.

2. **Enter Minimum Value:**
   In the **Left Axis Range Minimum** field,
   enter a value, e.g., `1e-2`,
   to ensure that only positive values are shown.
   This step is crucial to avoid error warnings in the next step.

3. **Enable Log Scale:**
   Click on **Left Axis Log Scale**
   to set the y-axis to a logarithmic scale.

4. **Apply Changes:**
   Click **Apply** to apply the changes.

5. **Logarithmic Y-Axis:**
   The y-axis of the $p^4 f_{000}(p)$ plot
   is now displayed in logarithmic scale.

   ![Logarithmic Y-Axis](https://sapphirepp.org/img/paraview-tutorial/f_p-05-annotated.png)

In the plot, you might notice some unusual artefacts and discontinuities.
These artefacts appear when trying to visualize the discontinuous Galerkin results
produced by @sapphire.
The section on
[Visualization Tips and Tricks](#visualization-tips)
discusses this topic in detail.
In our case, there is an easy way to get rid of these artefacts.
However, note that this trick might not always work:

1. **Change Sampling Pattern:**
   Change the **Sampling Pattern**
   to **Sample At Segment Centers**.

2. **Apply Changes:**
   Click **Apply** to apply the changes.

3. **Artefact-Free Plot:**
   The artefacts should now disappear,
   resulting in a continuous line plot.

   ![Artefact-Free Plot](https://sapphirepp.org/img/paraview-tutorial/f_p-06-annotated.png)

## Save the Plot {#paraview-save}

As a final step, we need to save and export the plot.
Using the 2D plot as an example,
we first need to label the axes:

1. **Select 2D Plot:**
   Click on *RenderView* to ensure the 2D plot is selected.

2. **Select Data to View:**
   In the *Pipeline Browser*,
   deactivate the *PlotOverLine* and *Calculator* objects
   to display only the original data.

3. **Activate Grid:**
   Enable the grid by clicking on **Data Axes Grid**.

4. **Open Grid Editor:**
   Click on **Data Axes Grid** > **Edit**
   to open the grid editor.

5. **Edit the Labels:**
   Adjust the **Title Texts** for the axes.
   LaTeX is supported,
   so we can use `$x$` for the **X Title**
   and `$\ln p$` for the **Y Title**.

6. **Confirm Changes:**
   Click **OK** to apply the changes.

   ![Label Axes](https://sapphirepp.org/img/paraview-tutorial/save-01-annotated.png)

Next, we change to a logarithmic color map.

1. **Set Custom Data Range:**
   Click on **Rescale to Custom Data Range**
   to open a dialog for entering the data range.

2. **Disable automatic rescaling:**
   Disable the **Enable automatic rescale** feature.

3. **Enter Data Range:**
   Enter a strictly positive data range,
   e.g. from `1e-2` to `10`.
   This step is crucial to avoid error warnings
   when using a logarithmic color map.

4. **Apply Changes:**
   Click **Ok** to apply the changes.

   ![Adjust Data Range](https://sapphirepp.org/img/paraview-tutorial/colormap-01-annotated.png)

5. **Open Color Map Editor:**
   Click on **Edit Color Map**
   to open the Color Map Editor.

6. **Color Map Editor:**
   A new window, the *Color Map Editor* is created.

7. **Logarithmic Color Map:**
   To use a logarithmic color map,
   click on **Use Log Scale When Mapping Data To Colors**.

8. **Change Color Map:**
   To use a perceptually uniform color map,
   change to the **Virdis (matplotlib)** color map.

9. **Close Color Map Editor:**
   Close the *Color Map Editor*
   by clicking on **x**.

   ![Change Color Map](https://sapphirepp.org/img/paraview-tutorial/colormap-02-annotated.png)

Finally, we can export the plot as an image and explore other useful features:

1. **Export Plot:**
   Click on **File** > **Save Screenshot...**
   to open a file dialog
   and save the plot as a `.png`
   or other image format.

2. **Save State:**
   Use **File** > **Save State...**
   to save the current state of the @paraview session.
   This allows you to close @paraview and continue your work later.

3. **Load State:**
   Use **File** > **Load State...**
   to resume your work from where you left off.

   ![Export Plot](https://sapphirepp.org/img/paraview-tutorial/save-02.2-annotated.png)

<div class="section_buttons">

| Previous                        |                                             Next |
|:--------------------------------|-------------------------------------------------:|
| [Visualization](#visualization) | [ParaView Python Introduction](#paraview-python) |

</div>

---

@author Florian Schulze (<florian.schulze@mpi-hd.mpg.de>)
@date 2024-07-31
